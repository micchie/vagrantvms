# Debian provisioning
---
- hosts: all
  vars:
    home: "/home/{{ user }}"
  sudo: True
  tasks:
    - name: ensure basic packages
      apt: name={{ item }} state=present
      with_items:
        - ethtool
        - git
        - vim-nox
        - zsh
        - screen
        - autoconf
        - automake
        - gcc
        - build-essential
    - name: download dracut 040
      get_url:
        # tarball in kernel.org doesn't work
        url: http://www.mirrorservice.org/pub/linux/utils/boot/dracut/dracut-040.tar.gz
        dest: '{{home}}/dracut-040.tar.gz'
    - name: untar dracut
      shell: tar xzf {{home}}/dracut-040.tar.gz -C {{home}}/
    - name: install dracut
      shell: cd {{home}}/dracut-040 && ./configure && make && make install && cd -
    - name:  edit dracut.conf
      lineinfile: >-
        dest=/etc/dracut.conf
        create=yes
        state=present
        line='add_drivers+="e1000e e1000 ixgbe"'
      #- name: touch .bashrc
      #file: path={{home}}/.bash_profile owner={{ user }} mode=0644 state=touch
    - name: set PATH for bash
      lineinfile: >-
        dest={{home}}/.bash_profile
        create=yes
        state=present
        line='export PATH=$PATH:/sbin:/usr/sbin:/usr/local/sbin'
