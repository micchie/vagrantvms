# Vagrantfile to try out PASTE
This Vagrantfile sets up a VM that has installed PASTE and an example app and serves requests generated by the host over TCP.
PASTE (stands for Packet Store)
* Enables NIC DMA to Non-Volatile Main Memory (NVMM)
* Helps apps organize persistent data structures (e.g., WAL, B+tree) on NVMM
* Lets apps use the kernel TCP/IP and be protected
* Is a high-performance network stack even without NVMM, making your apps ready to support it.

Michio Honda, Giuseppe Lettieri, Lars Eggert and Douglas Santry, "PASTE: A Network Programming Interface for Non-Volatile Main Memory", USENIX NSDI 2018 (https://www.usenix.org/conference/nsdi18/presentation/honda) 


## The VM contains:
* Linux kernel 4.11 compiled with necessary configuration (deployed/net-next/.config)
* PASTE implementation (deployed/netmap) and a test app (deployed/tinyhttpd)
* Reserved DRAM region for NVMM emulation (/dev/pmem0)

## Prerequisite
* Install Virtualbox, Vagrant in your Mac or Linux
* Install wrk in your Mac (brew install wrk) or Linux (apt-get install wrk)
* Download vagrant box (`https://drive.google.com/file/d/1NIwQzuLIYjOwygCovcY8_ZbXimVoCbWf/view?usp=sharing`)
* Note that the VM will launch with 2GB of memory (including emulated NVMM)

## How to lunch the VM
`host% mkdir pastevm`

`host% cp Vagrantfile pastevm/`

`host% cd pastevm`

`host% vagrant box add paste.box`

`host% vagrant up`

## How to run PASTE in the VM
Note: I use prompt `host%` for commands to be executed at the host, and `vm%` for those to be executed at the VM

SSH to the VM

`host% vagrant ssh`

Setup emulated NVMM, NICs etc.

`vm% sudo bash -x ./setup.sh`

Confirm your host can talk to this VM with the experiment NIC

`host% ping 192.168.15.15 on your host (not in this VM)`

Edit Vagrantfile and setup.sh in the VM (and "vagrant reload") if you want to change this VM's address

Run tinyhttpd app in this VM

`vm% sudo ./deployed/tinyhttpd/tinyhttpd -i eth1 -d /mnt/pmem/dumb -m -x768`

Run wrk in your host

`host% wrk -d 2 -c 10 -t 10 http://192.168.15.15:60000/ -s ~/devel/tinyhttpd/post1280.lua`	

## Contact
Michio Honda (email: micchie [at] sfc.wide.ad.jp or twitter: @michioh)